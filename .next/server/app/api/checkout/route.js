"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/checkout/route";
exports.ids = ["app/api/checkout/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "assert":
/*!*************************!*\
  !*** external "assert" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("assert");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "querystring":
/*!******************************!*\
  !*** external "querystring" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("querystring");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcheckout%2Froute&page=%2Fapi%2Fcheckout%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcheckout%2Froute.ts&appDir=C%3A%5CUsers%5Cbeatr%5CDownloads%5Cuvpayment%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cbeatr%5CDownloads%5Cuvpayment&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcheckout%2Froute&page=%2Fapi%2Fcheckout%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcheckout%2Froute.ts&appDir=C%3A%5CUsers%5Cbeatr%5CDownloads%5Cuvpayment%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cbeatr%5CDownloads%5Cuvpayment&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_beatr_Downloads_uvpayment_app_api_checkout_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/checkout/route.ts */ \"(rsc)/./app/api/checkout/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/checkout/route\",\n        pathname: \"/api/checkout\",\n        filename: \"route\",\n        bundlePath: \"app/api/checkout/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\beatr\\\\Downloads\\\\uvpayment\\\\app\\\\api\\\\checkout\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_beatr_Downloads_uvpayment_app_api_checkout_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/checkout/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZjaGVja291dCUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGY2hlY2tvdXQlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZjaGVja291dCUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNiZWF0ciU1Q0Rvd25sb2FkcyU1Q3V2cGF5bWVudCU1Q2FwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9QyUzQSU1Q1VzZXJzJTVDYmVhdHIlNUNEb3dubG9hZHMlNUN1dnBheW1lbnQmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ29CO0FBQ2pHO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdXZwYXltZW50Lz9hM2U2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIkM6XFxcXFVzZXJzXFxcXGJlYXRyXFxcXERvd25sb2Fkc1xcXFx1dnBheW1lbnRcXFxcYXBwXFxcXGFwaVxcXFxjaGVja291dFxcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvY2hlY2tvdXQvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9jaGVja291dFwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvY2hlY2tvdXQvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJDOlxcXFxVc2Vyc1xcXFxiZWF0clxcXFxEb3dubG9hZHNcXFxcdXZwYXltZW50XFxcXGFwcFxcXFxhcGlcXFxcY2hlY2tvdXRcXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2NoZWNrb3V0L3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcheckout%2Froute&page=%2Fapi%2Fcheckout%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcheckout%2Froute.ts&appDir=C%3A%5CUsers%5Cbeatr%5CDownloads%5Cuvpayment%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cbeatr%5CDownloads%5Cuvpayment&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/auth/[...nextauth]/route.ts":
/*!*********************************************!*\
  !*** ./app/api/auth/[...nextauth]/route.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ handler),\n/* harmony export */   POST: () => (/* binding */ handler),\n/* harmony export */   authOptions: () => (/* binding */ authOptions)\n/* harmony export */ });\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth */ \"(rsc)/./node_modules/next-auth/index.js\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_auth__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_auth_providers_discord__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next-auth/providers/discord */ \"(rsc)/./node_modules/next-auth/providers/discord.js\");\n/* harmony import */ var _lib_supabase__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/supabase */ \"(rsc)/./lib/supabase.ts\");\n\n\n\n// Helper to ensure environment variables are set\nconst ensureEnv = (value, name)=>{\n    if (!value) {\n        throw new Error(`Environment variable ${name} is not set`);\n    }\n    return value;\n};\n// Required environment variables\nconst DISCORD_CLIENT_ID = ensureEnv(process.env.DISCORD_CLIENT_ID, \"DISCORD_CLIENT_ID\");\nconst DISCORD_CLIENT_SECRET = ensureEnv(process.env.DISCORD_CLIENT_SECRET, \"DISCORD_CLIENT_SECRET\");\nconst NEXTAUTH_SECRET = ensureEnv(process.env.NEXTAUTH_SECRET, \"NEXTAUTH_SECRET\");\n// Optional: Owner Discord ID for God Mode\nconst OWNER_DISCORD_ID = process.env.OWNER_DISCORD_ID || \"\";\nif (!_lib_supabase__WEBPACK_IMPORTED_MODULE_2__.supabaseAdmin) {\n    throw new Error(\"SUPABASE_SERVICE_ROLE_KEY is not configured\");\n}\nconst authOptions = {\n    secret: NEXTAUTH_SECRET,\n    session: {\n        strategy: \"jwt\"\n    },\n    providers: [\n        (0,next_auth_providers_discord__WEBPACK_IMPORTED_MODULE_1__[\"default\"])({\n            clientId: DISCORD_CLIENT_ID,\n            clientSecret: DISCORD_CLIENT_SECRET,\n            authorization: {\n                params: {\n                    scope: \"identify email\"\n                }\n            }\n        })\n    ],\n    pages: {\n        signIn: \"/\",\n        error: \"/?error=auth_error\"\n    },\n    debug: \"development\" === \"development\",\n    callbacks: {\n        async signIn ({ account, profile, user }) {\n            console.log(\"\\n========== \\uD83D\\uDD35 SIGN-IN CALLBACK START ==========\");\n            console.log(\"User Email:\", user?.email);\n            console.log(\"User Name:\", user?.name);\n            console.log(\"Discord ID:\", profile?.id || account?.providerAccountId);\n            // Timeout wrapper to prevent infinite hangs\n            const timeoutPromise = new Promise((resolve)=>{\n                setTimeout(()=>{\n                    console.error(\"\\n⏰ SIGN-IN CALLBACK TIMEOUT! Forcing success after 10 seconds.\");\n                    resolve(true);\n                }, 10000); // 10 second timeout\n            });\n            const signInPromise = (async ()=>{\n                // Try to save to database but don't block login if it fails\n                try {\n                    const discordId = profile?.id?.toString() ?? account?.providerAccountId ?? \"\";\n                    const email = user.email ?? profile?.email?.toString();\n                    const avatarUrl = user.image ?? profile?.avatar;\n                    const username = user.name ?? profile?.username ?? \"\";\n                    console.log(\"\\n\\uD83D\\uDCDD Data to save:\");\n                    console.log(\"  - Discord ID:\", discordId);\n                    console.log(\"  - Email:\", email);\n                    console.log(\"  - Username:\", username);\n                    console.log(\"  - Avatar URL:\", avatarUrl);\n                    console.log(\"  - Supabase Admin Ready?\", !!_lib_supabase__WEBPACK_IMPORTED_MODULE_2__.supabaseAdmin);\n                    console.log(\"  - OWNER_DISCORD_ID from env:\", OWNER_DISCORD_ID);\n                    if (!discordId) {\n                        console.error(\"\\n❌ CRITICAL: No Discord ID found! Cannot save profile.\");\n                        console.log(\"========== \\uD83D\\uDD35 SIGN-IN CALLBACK END ==========\\n\");\n                        return true;\n                    }\n                    if (!email) {\n                        console.error(\"\\n❌ WARNING: No email found! Saving without email.\");\n                    }\n                    if (!_lib_supabase__WEBPACK_IMPORTED_MODULE_2__.supabaseAdmin) {\n                        console.error(\"\\n❌ CRITICAL: Supabase Admin client not initialized!\");\n                        console.log(\"========== \\uD83D\\uDD35 SIGN-IN CALLBACK END ==========\\n\");\n                        return true;\n                    }\n                    // Determine role (owner check)\n                    let role = \"guest\";\n                    if (OWNER_DISCORD_ID && discordId === OWNER_DISCORD_ID) {\n                        role = \"owner\";\n                        console.log('\\n\\uD83D\\uDC51 OWNER DETECTED! Setting role to \"owner\"');\n                    }\n                    // Check if user already exists\n                    console.log(\"\\n\\uD83D\\uDD0D Checking if profile exists in database...\");\n                    const { data: existingProfile, error: selectError } = await _lib_supabase__WEBPACK_IMPORTED_MODULE_2__.supabaseAdmin.from(\"profiles\").select(\"*\").eq(\"discord_id\", discordId).maybeSingle();\n                    if (selectError) {\n                        console.error(\"\\n❌ Error checking profile:\", selectError.message);\n                        console.error(\"Error Code:\", selectError.code);\n                        console.error(\"Error Details:\", JSON.stringify(selectError, null, 2));\n                    }\n                    if (existingProfile) {\n                        console.log(\"\\n✅ Profile EXISTS! Updating...\");\n                        console.log(\"Existing profile ID:\", existingProfile.id);\n                        const { data: updateData, error: updateError } = await _lib_supabase__WEBPACK_IMPORTED_MODULE_2__.supabaseAdmin.from(\"profiles\").update({\n                            email,\n                            avatar_url: avatarUrl,\n                            role\n                        }).eq(\"discord_id\", discordId).select();\n                        if (updateError) {\n                            console.error(\"\\n❌ UPDATE FAILED!\");\n                            console.error(\"Error Message:\", updateError.message);\n                            console.error(\"Error Code:\", updateError.code);\n                            console.error(\"Error Details:\", JSON.stringify(updateError, null, 2));\n                        } else {\n                            console.log(\"\\n✅ PROFILE UPDATED SUCCESSFULLY!\");\n                            console.log(\"Updated Data:\", JSON.stringify(updateData, null, 2));\n                        }\n                    } else {\n                        console.log(\"\\n\\uD83C\\uDD95 Profile DOES NOT EXIST! Creating new profile...\");\n                        const newProfile = {\n                            discord_id: discordId,\n                            email,\n                            avatar_url: avatarUrl,\n                            role,\n                            subscription_status: \"inactive\"\n                        };\n                        console.log(\"Data to insert:\", JSON.stringify(newProfile, null, 2));\n                        const { data: insertData, error: insertError } = await _lib_supabase__WEBPACK_IMPORTED_MODULE_2__.supabaseAdmin.from(\"profiles\").insert(newProfile).select();\n                        if (insertError) {\n                            console.error(\"\\n❌ INSERT FAILED!\");\n                            console.error(\"Error Message:\", insertError.message);\n                            console.error(\"Error Code:\", insertError.code);\n                            console.error(\"Error Hint:\", insertError.hint);\n                            console.error(\"Error Details:\", JSON.stringify(insertError, null, 2));\n                        } else {\n                            console.log(\"\\n✅ PROFILE CREATED SUCCESSFULLY!\");\n                            console.log(\"New Profile Data:\", JSON.stringify(insertData, null, 2));\n                        }\n                    }\n                } catch (error) {\n                    console.error(\"\\n❌ EXCEPTION CAUGHT IN SIGN-IN CALLBACK!\");\n                    console.error(\"Exception:\", error);\n                    if (error instanceof Error) {\n                        console.error(\"Error Message:\", error.message);\n                        console.error(\"Error Stack:\", error.stack);\n                    }\n                }\n                console.log(\"\\n✅ Login approved for:\", user?.email);\n                console.log(\"========== \\uD83D\\uDD35 SIGN-IN CALLBACK END ==========\\n\");\n                return true;\n            })();\n            // Race between actual sign-in and timeout\n            return Promise.race([\n                signInPromise,\n                timeoutPromise\n            ]);\n        },\n        async jwt ({ token, user, account }) {\n            console.log(\"\\n========== \\uD83D\\uDFE1 JWT CALLBACK START ==========\");\n            try {\n                // Store Discord ID in token\n                if (account?.providerAccountId) {\n                    token.discord_id = account.providerAccountId;\n                    console.log(\"Stored Discord ID in token:\", token.discord_id);\n                }\n                if (token?.discord_id) {\n                    console.log(\"Fetching profile for Discord ID:\", token.discord_id);\n                    const { data, error } = await _lib_supabase__WEBPACK_IMPORTED_MODULE_2__.supabaseAdmin.from(\"profiles\").select(\"id, role, discord_id\").eq(\"discord_id\", token.discord_id).maybeSingle();\n                    if (error) {\n                        console.error(\"❌ Error fetching profile in JWT callback:\", error);\n                        token.role = \"guest\";\n                        console.log(\"========== \\uD83D\\uDFE1 JWT CALLBACK END ==========\\n\");\n                        return token;\n                    }\n                    if (!data) {\n                        console.log(\"⚠️ No profile found for Discord ID:\", token.discord_id);\n                        token.role = \"guest\";\n                        console.log(\"========== \\uD83D\\uDFE1 JWT CALLBACK END ==========\\n\");\n                        return token;\n                    }\n                    console.log(\"✅ Profile found:\", data);\n                    // Store the database UUID in token for session\n                    token.sub = data.id;\n                    let role = data?.role ?? \"guest\";\n                    // Owner backdoor: Override role if Discord ID matches\n                    if (OWNER_DISCORD_ID && data?.discord_id === OWNER_DISCORD_ID) {\n                        console.log(\"\\uD83D\\uDC51 OWNER MATCH! Upgrading role to owner\");\n                        console.log(\"  - OWNER_DISCORD_ID:\", OWNER_DISCORD_ID);\n                        console.log(\"  - User Discord ID:\", data.discord_id);\n                        role = \"owner\";\n                        // Persist owner role to database\n                        const { error: updateError } = await _lib_supabase__WEBPACK_IMPORTED_MODULE_2__.supabaseAdmin.from(\"profiles\").update({\n                            role: \"owner\"\n                        }).eq(\"discord_id\", token.discord_id);\n                        if (updateError) {\n                            console.error(\"❌ Failed to update owner role:\", updateError);\n                        } else {\n                            console.log(\"✅ Owner role updated in database\");\n                        }\n                    }\n                    token.role = role;\n                    console.log(\"Final token role:\", token.role);\n                }\n                console.log(\"========== \\uD83D\\uDFE1 JWT CALLBACK END ==========\\n\");\n                return token;\n            } catch (error) {\n                console.error(\"❌ JWT callback exception:\", error);\n                console.log(\"========== \\uD83D\\uDFE1 JWT CALLBACK END ==========\\n\");\n                return token;\n            }\n        },\n        async session ({ session, token }) {\n            try {\n                if (session.user) {\n                    session.user.id = token.sub;\n                    session.user.role = token.role ?? \"guest\";\n                }\n                return session;\n            } catch (error) {\n                console.error(\"Session callback error:\", error);\n                return session;\n            }\n        }\n    }\n};\nconst handler = next_auth__WEBPACK_IMPORTED_MODULE_0___default()(authOptions);\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2F1dGgvWy4uLm5leHRhdXRoXS9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQTJEO0FBQ0Q7QUFDWDtBQUcvQyxpREFBaUQ7QUFDakQsTUFBTUcsWUFBWSxDQUFDQyxPQUEyQkM7SUFDNUMsSUFBSSxDQUFDRCxPQUFPO1FBQ1YsTUFBTSxJQUFJRSxNQUFNLENBQUMscUJBQXFCLEVBQUVELEtBQUssV0FBVyxDQUFDO0lBQzNEO0lBQ0EsT0FBT0Q7QUFDVDtBQUVBLGlDQUFpQztBQUNqQyxNQUFNRyxvQkFBb0JKLFVBQVVLLFFBQVFDLEdBQUcsQ0FBQ0YsaUJBQWlCLEVBQUU7QUFDbkUsTUFBTUcsd0JBQXdCUCxVQUFVSyxRQUFRQyxHQUFHLENBQUNDLHFCQUFxQixFQUFFO0FBQzNFLE1BQU1DLGtCQUFrQlIsVUFBVUssUUFBUUMsR0FBRyxDQUFDRSxlQUFlLEVBQUU7QUFFL0QsMENBQTBDO0FBQzFDLE1BQU1DLG1CQUFtQkosUUFBUUMsR0FBRyxDQUFDRyxnQkFBZ0IsSUFBSTtBQUV6RCxJQUFJLENBQUNWLHdEQUFhQSxFQUFFO0lBQ2xCLE1BQU0sSUFBSUksTUFBTTtBQUNsQjtBQUVPLE1BQU1PLGNBQStCO0lBQzFDQyxRQUFRSDtJQUNSSSxTQUFTO1FBQUVDLFVBQVU7SUFBTTtJQUMzQkMsV0FBVztRQUNUaEIsdUVBQWVBLENBQUM7WUFDZGlCLFVBQVVYO1lBQ1ZZLGNBQWNUO1lBQ2RVLGVBQWU7Z0JBQUVDLFFBQVE7b0JBQUVDLE9BQU87Z0JBQWlCO1lBQUU7UUFDdkQ7S0FDRDtJQUNEQyxPQUFPO1FBQ0xDLFFBQVE7UUFDUkMsT0FBTztJQUNUO0lBQ0FDLE9BQU9sQixrQkFBeUI7SUFDaENtQixXQUFXO1FBQ1QsTUFBTUgsUUFBTyxFQUFFSSxPQUFPLEVBQUVDLE9BQU8sRUFBRUMsSUFBSSxFQUFFO1lBQ3JDQyxRQUFRQyxHQUFHLENBQUM7WUFDWkQsUUFBUUMsR0FBRyxDQUFDLGVBQWVGLE1BQU1HO1lBQ2pDRixR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UUFBUWUsSUFBSSxDQUFDaUIsSUFBSSxHQUFHLE1BQU9BLElBQUksSUFBd0I7Z0JBQ3pEO2dCQUVBLE9BQU9oQztZQUNULEVBQUUsT0FBT1UsT0FBTztnQkFDZE0sUUFBUU4sS0FBSyxDQUFDLDJCQUEyQkE7Z0JBQ3pDLE9BQU9WO1lBQ1Q7UUFDRjtJQUNGO0FBQ0YsRUFBRTtBQUVGLE1BQU00RCxVQUFVM0UsZ0RBQVFBLENBQUNhO0FBRWtCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdXZwYXltZW50Ly4vYXBwL2FwaS9hdXRoL1suLi5uZXh0YXV0aF0vcm91dGUudHM/YzhhNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTmV4dEF1dGgsIHsgdHlwZSBOZXh0QXV0aE9wdGlvbnMgfSBmcm9tICduZXh0LWF1dGgnO1xuaW1wb3J0IERpc2NvcmRQcm92aWRlciBmcm9tICduZXh0LWF1dGgvcHJvdmlkZXJzL2Rpc2NvcmQnO1xuaW1wb3J0IHsgc3VwYWJhc2VBZG1pbiB9IGZyb20gJ0AvbGliL3N1cGFiYXNlJztcbmltcG9ydCB0eXBlIHsgUHJvZmlsZSB9IGZyb20gJ0AvdHlwZXNfZGInO1xuXG4vLyBIZWxwZXIgdG8gZW5zdXJlIGVudmlyb25tZW50IHZhcmlhYmxlcyBhcmUgc2V0XG5jb25zdCBlbnN1cmVFbnYgPSAodmFsdWU6IHN0cmluZyB8IHVuZGVmaW5lZCwgbmFtZTogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgaWYgKCF2YWx1ZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgRW52aXJvbm1lbnQgdmFyaWFibGUgJHtuYW1lfSBpcyBub3Qgc2V0YCk7XG4gIH1cbiAgcmV0dXJuIHZhbHVlO1xufTtcblxuLy8gUmVxdWlyZWQgZW52aXJvbm1lbnQgdmFyaWFibGVzXG5jb25zdCBESVNDT1JEX0NMSUVOVF9JRCA9IGVuc3VyZUVudihwcm9jZXNzLmVudi5ESVNDT1JEX0NMSUVOVF9JRCwgJ0RJU0NPUkRfQ0xJRU5UX0lEJyk7XG5jb25zdCBESVNDT1JEX0NMSUVOVF9TRUNSRVQgPSBlbnN1cmVFbnYocHJvY2Vzcy5lbnYuRElTQ09SRF9DTElFTlRfU0VDUkVULCAnRElTQ09SRF9DTElFTlRfU0VDUkVUJyk7XG5jb25zdCBORVhUQVVUSF9TRUNSRVQgPSBlbnN1cmVFbnYocHJvY2Vzcy5lbnYuTkVYVEFVVEhfU0VDUkVULCAnTkVYVEFVVEhfU0VDUkVUJyk7XG5cbi8vIE9wdGlvbmFsOiBPd25lciBEaXNjb3JkIElEIGZvciBHb2QgTW9kZVxuY29uc3QgT1dORVJfRElTQ09SRF9JRCA9IHByb2Nlc3MuZW52Lk9XTkVSX0RJU0NPUkRfSUQgfHwgJyc7XG5cbmlmICghc3VwYWJhc2VBZG1pbikge1xuICB0aHJvdyBuZXcgRXJyb3IoJ1NVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkgaXMgbm90IGNvbmZpZ3VyZWQnKTtcbn1cblxuZXhwb3J0IGNvbnN0IGF1dGhPcHRpb25zOiBOZXh0QXV0aE9wdGlvbnMgPSB7XG4gIHNlY3JldDogTkVYVEFVVEhfU0VDUkVULFxuICBzZXNzaW9uOiB7IHN0cmF0ZWd5OiAnand0JyB9LFxuICBwcm92aWRlcnM6IFtcbiAgICBEaXNjb3JkUHJvdmlkZXIoe1xuICAgICAgY2xpZW50SWQ6IERJU0NPUkRfQ0xJRU5UX0lELFxuICAgICAgY2xpZW50U2VjcmV0OiBESVNDT1JEX0NMSUVOVF9TRUNSRVQsXG4gICAgICBhdXRob3JpemF0aW9uOiB7IHBhcmFtczogeyBzY29wZTogJ2lkZW50aWZ5IGVtYWlsJyB9IH0sXG4gICAgfSksXG4gIF0sXG4gIHBhZ2VzOiB7XG4gICAgc2lnbkluOiAnLycsXG4gICAgZXJyb3I6ICcvP2Vycm9yPWF1dGhfZXJyb3InLCAvLyBTaG93IGVycm9yIG9uIGhvbWUgcGFnZVxuICB9LFxuICBkZWJ1ZzogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcsXG4gIGNhbGxiYWNrczoge1xuICAgIGFzeW5jIHNpZ25Jbih7IGFjY291bnQsIHByb2ZpbGUsIHVzZXIgfSkge1xuICAgICAgY29uc29sZS5sb2coJ1xcbj09PT09PT09PT0g8J+UtSBTSUdOLUlOIENBTExCQUNLIFNUQVJUID09PT09PT09PT0nKTtcbiAgICAgIGNvbnNvbGUubG9nKCdVc2VyIEVtYWlsOicsIHVzZXI/LmVtYWlsKTtcbiAgICAgIGNvbnNvbGUubG9nKCdVc2VyIE5hbWU6JywgdXNlcj8ubmFtZSk7XG4gICAgICBjb25zb2xlLmxvZygnRGlzY29yZCBJRDonLCBwcm9maWxlPy5pZCB8fCBhY2NvdW50Py5wcm92aWRlckFjY291bnRJZCk7XG5cbiAgICAgIC8vIFRpbWVvdXQgd3JhcHBlciB0byBwcmV2ZW50IGluZmluaXRlIGhhbmdzXG4gICAgICBjb25zdCB0aW1lb3V0UHJvbWlzZSA9IG5ldyBQcm9taXNlPGJvb2xlYW4+KChyZXNvbHZlKSA9PiB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1xcbuKPsCBTSUdOLUlOIENBTExCQUNLIFRJTUVPVVQhIEZvcmNpbmcgc3VjY2VzcyBhZnRlciAxMCBzZWNvbmRzLicpO1xuICAgICAgICAgIHJlc29sdmUodHJ1ZSk7XG4gICAgICAgIH0sIDEwMDAwKTsgLy8gMTAgc2Vjb25kIHRpbWVvdXRcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBzaWduSW5Qcm9taXNlID0gKGFzeW5jICgpID0+IHtcbiAgICAgICAgLy8gVHJ5IHRvIHNhdmUgdG8gZGF0YWJhc2UgYnV0IGRvbid0IGJsb2NrIGxvZ2luIGlmIGl0IGZhaWxzXG4gICAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGRpc2NvcmRJZCA9IHByb2ZpbGU/LmlkPy50b1N0cmluZygpID8/IGFjY291bnQ/LnByb3ZpZGVyQWNjb3VudElkID8/ICcnO1xuICAgICAgICBjb25zdCBlbWFpbCA9IHVzZXIuZW1haWwgPz8gKHByb2ZpbGUgYXMgUmVjb3JkPHN0cmluZywgYW55Pik/LmVtYWlsPy50b1N0cmluZygpO1xuICAgICAgICBjb25zdCBhdmF0YXJVcmwgPSB1c2VyLmltYWdlID8/IChwcm9maWxlIGFzIFJlY29yZDxzdHJpbmcsIGFueT4pPy5hdmF0YXI7XG4gICAgICAgIGNvbnN0IHVzZXJuYW1lID0gdXNlci5uYW1lID8/IChwcm9maWxlIGFzIFJlY29yZDxzdHJpbmcsIGFueT4pPy51c2VybmFtZSA/PyAnJztcblxuICAgICAgICBjb25zb2xlLmxvZygnXFxu8J+TnSBEYXRhIHRvIHNhdmU6Jyk7XG4gICAgICAgIGNvbnNvbGUubG9nKCcgIC0gRGlzY29yZCBJRDonLCBkaXNjb3JkSWQpO1xuICAgICAgICBjb25zb2xlLmxvZygnICAtIEVtYWlsOicsIGVtYWlsKTtcbiAgICAgICAgY29uc29sZS5sb2coJyAgLSBVc2VybmFtZTonLCB1c2VybmFtZSk7XG4gICAgICAgIGNvbnNvbGUubG9nKCcgIC0gQXZhdGFyIFVSTDonLCBhdmF0YXJVcmwpO1xuICAgICAgICBjb25zb2xlLmxvZygnICAtIFN1cGFiYXNlIEFkbWluIFJlYWR5PycsICEhc3VwYWJhc2VBZG1pbik7XG4gICAgICAgIGNvbnNvbGUubG9nKCcgIC0gT1dORVJfRElTQ09SRF9JRCBmcm9tIGVudjonLCBPV05FUl9ESVNDT1JEX0lEKTtcblxuICAgICAgICBpZiAoIWRpc2NvcmRJZCkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1xcbuKdjCBDUklUSUNBTDogTm8gRGlzY29yZCBJRCBmb3VuZCEgQ2Fubm90IHNhdmUgcHJvZmlsZS4nKTtcbiAgICAgICAgICBjb25zb2xlLmxvZygnPT09PT09PT09PSDwn5S1IFNJR04tSU4gQ0FMTEJBQ0sgRU5EID09PT09PT09PT1cXG4nKTtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghZW1haWwpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdcXG7inYwgV0FSTklORzogTm8gZW1haWwgZm91bmQhIFNhdmluZyB3aXRob3V0IGVtYWlsLicpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFzdXBhYmFzZUFkbWluKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignXFxu4p2MIENSSVRJQ0FMOiBTdXBhYmFzZSBBZG1pbiBjbGllbnQgbm90IGluaXRpYWxpemVkIScpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKCc9PT09PT09PT09IPCflLUgU0lHTi1JTiBDQUxMQkFDSyBFTkQgPT09PT09PT09PVxcbicpO1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRGV0ZXJtaW5lIHJvbGUgKG93bmVyIGNoZWNrKVxuICAgICAgICBsZXQgcm9sZTogJ293bmVyJyB8ICdhZG1pbicgfCAnbWVtYmVyJyB8ICdndWVzdCcgPSAnZ3Vlc3QnO1xuICAgICAgICBpZiAoT1dORVJfRElTQ09SRF9JRCAmJiBkaXNjb3JkSWQgPT09IE9XTkVSX0RJU0NPUkRfSUQpIHtcbiAgICAgICAgICByb2xlID0gJ293bmVyJztcbiAgICAgICAgICBjb25zb2xlLmxvZygnXFxu8J+RkSBPV05FUiBERVRFQ1RFRCEgU2V0dGluZyByb2xlIHRvIFwib3duZXJcIicpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgdXNlciBhbHJlYWR5IGV4aXN0c1xuICAgICAgICBjb25zb2xlLmxvZygnXFxu8J+UjSBDaGVja2luZyBpZiBwcm9maWxlIGV4aXN0cyBpbiBkYXRhYmFzZS4uLicpO1xuICAgICAgICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nUHJvZmlsZSwgZXJyb3I6IHNlbGVjdEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXG4gICAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcbiAgICAgICAgICAuc2VsZWN0KCcqJylcbiAgICAgICAgICAuZXEoJ2Rpc2NvcmRfaWQnLCBkaXNjb3JkSWQpXG4gICAgICAgICAgLm1heWJlU2luZ2xlKCk7XG5cbiAgICAgICAgaWYgKHNlbGVjdEVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignXFxu4p2MIEVycm9yIGNoZWNraW5nIHByb2ZpbGU6Jywgc2VsZWN0RXJyb3IubWVzc2FnZSk7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgQ29kZTonLCBzZWxlY3RFcnJvci5jb2RlKTtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBEZXRhaWxzOicsIEpTT04uc3RyaW5naWZ5KHNlbGVjdEVycm9yLCBudWxsLCAyKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZXhpc3RpbmdQcm9maWxlKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1xcbuKchSBQcm9maWxlIEVYSVNUUyEgVXBkYXRpbmcuLi4nKTtcbiAgICAgICAgICBjb25zb2xlLmxvZygnRXhpc3RpbmcgcHJvZmlsZSBJRDonLCBleGlzdGluZ1Byb2ZpbGUuaWQpO1xuXG4gICAgICAgICAgY29uc3QgeyBkYXRhOiB1cGRhdGVEYXRhLCBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgICAgICAgIC5mcm9tKCdwcm9maWxlcycpXG4gICAgICAgICAgICAudXBkYXRlKHtcbiAgICAgICAgICAgICAgZW1haWwsXG4gICAgICAgICAgICAgIGF2YXRhcl91cmw6IGF2YXRhclVybCxcbiAgICAgICAgICAgICAgcm9sZSwgLy8gVXBkYXRlIHJvbGUgaW4gY2FzZSBpdCBjaGFuZ2VkIChlLmcuLCBiZWNhbWUgb3duZXIpXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmVxKCdkaXNjb3JkX2lkJywgZGlzY29yZElkKVxuICAgICAgICAgICAgLnNlbGVjdCgpO1xuXG4gICAgICAgICAgaWYgKHVwZGF0ZUVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdcXG7inYwgVVBEQVRFIEZBSUxFRCEnKTtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIE1lc3NhZ2U6JywgdXBkYXRlRXJyb3IubWVzc2FnZSk7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBDb2RlOicsIHVwZGF0ZUVycm9yLmNvZGUpO1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgRGV0YWlsczonLCBKU09OLnN0cmluZ2lmeSh1cGRhdGVFcnJvciwgbnVsbCwgMikpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnXFxu4pyFIFBST0ZJTEUgVVBEQVRFRCBTVUNDRVNTRlVMTFkhJyk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnVXBkYXRlZCBEYXRhOicsIEpTT04uc3RyaW5naWZ5KHVwZGF0ZURhdGEsIG51bGwsIDIpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1xcbvCfhpUgUHJvZmlsZSBET0VTIE5PVCBFWElTVCEgQ3JlYXRpbmcgbmV3IHByb2ZpbGUuLi4nKTtcblxuICAgICAgICAgIGNvbnN0IG5ld1Byb2ZpbGUgPSB7XG4gICAgICAgICAgICBkaXNjb3JkX2lkOiBkaXNjb3JkSWQsXG4gICAgICAgICAgICBlbWFpbCxcbiAgICAgICAgICAgIGF2YXRhcl91cmw6IGF2YXRhclVybCxcbiAgICAgICAgICAgIHJvbGUsXG4gICAgICAgICAgICBzdWJzY3JpcHRpb25fc3RhdHVzOiAnaW5hY3RpdmUnIGFzIGNvbnN0LFxuICAgICAgICAgIH07XG5cbiAgICAgICAgICBjb25zb2xlLmxvZygnRGF0YSB0byBpbnNlcnQ6JywgSlNPTi5zdHJpbmdpZnkobmV3UHJvZmlsZSwgbnVsbCwgMikpO1xuXG4gICAgICAgICAgY29uc3QgeyBkYXRhOiBpbnNlcnREYXRhLCBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgICAgICAgIC5mcm9tKCdwcm9maWxlcycpXG4gICAgICAgICAgICAuaW5zZXJ0KG5ld1Byb2ZpbGUpXG4gICAgICAgICAgICAuc2VsZWN0KCk7XG5cbiAgICAgICAgICBpZiAoaW5zZXJ0RXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1xcbuKdjCBJTlNFUlQgRkFJTEVEIScpO1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgTWVzc2FnZTonLCBpbnNlcnRFcnJvci5tZXNzYWdlKTtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIENvZGU6JywgaW5zZXJ0RXJyb3IuY29kZSk7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBIaW50OicsIGluc2VydEVycm9yLmhpbnQpO1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgRGV0YWlsczonLCBKU09OLnN0cmluZ2lmeShpbnNlcnRFcnJvciwgbnVsbCwgMikpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnXFxu4pyFIFBST0ZJTEUgQ1JFQVRFRCBTVUNDRVNTRlVMTFkhJyk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnTmV3IFByb2ZpbGUgRGF0YTonLCBKU09OLnN0cmluZ2lmeShpbnNlcnREYXRhLCBudWxsLCAyKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdcXG7inYwgRVhDRVBUSU9OIENBVUdIVCBJTiBTSUdOLUlOIENBTExCQUNLIScpO1xuICAgICAgICBjb25zb2xlLmVycm9yKCdFeGNlcHRpb246JywgZXJyb3IpO1xuICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIE1lc3NhZ2U6JywgZXJyb3IubWVzc2FnZSk7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgU3RhY2s6JywgZXJyb3Iuc3RhY2spO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgICAgY29uc29sZS5sb2coJ1xcbuKchSBMb2dpbiBhcHByb3ZlZCBmb3I6JywgdXNlcj8uZW1haWwpO1xuICAgICAgICBjb25zb2xlLmxvZygnPT09PT09PT09PSDwn5S1IFNJR04tSU4gQ0FMTEJBQ0sgRU5EID09PT09PT09PT1cXG4nKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9KSgpO1xuXG4gICAgICAvLyBSYWNlIGJldHdlZW4gYWN0dWFsIHNpZ24taW4gYW5kIHRpbWVvdXRcbiAgICAgIHJldHVybiBQcm9taXNlLnJhY2UoW3NpZ25JblByb21pc2UsIHRpbWVvdXRQcm9taXNlXSk7XG4gICAgfSxcbiAgICBhc3luYyBqd3QoeyB0b2tlbiwgdXNlciwgYWNjb3VudCB9KSB7XG4gICAgICBjb25zb2xlLmxvZygnXFxuPT09PT09PT09PSDwn5+hIEpXVCBDQUxMQkFDSyBTVEFSVCA9PT09PT09PT09Jyk7XG4gICAgICB0cnkge1xuICAgICAgICAvLyBTdG9yZSBEaXNjb3JkIElEIGluIHRva2VuXG4gICAgICAgIGlmIChhY2NvdW50Py5wcm92aWRlckFjY291bnRJZCkge1xuICAgICAgICAgIHRva2VuLmRpc2NvcmRfaWQgPSBhY2NvdW50LnByb3ZpZGVyQWNjb3VudElkO1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdTdG9yZWQgRGlzY29yZCBJRCBpbiB0b2tlbjonLCB0b2tlbi5kaXNjb3JkX2lkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0b2tlbj8uZGlzY29yZF9pZCkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdGZXRjaGluZyBwcm9maWxlIGZvciBEaXNjb3JkIElEOicsIHRva2VuLmRpc2NvcmRfaWQpO1xuXG4gICAgICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pbiFcbiAgICAgICAgICAgIC5mcm9tKCdwcm9maWxlcycpXG4gICAgICAgICAgICAuc2VsZWN0KCdpZCwgcm9sZSwgZGlzY29yZF9pZCcpXG4gICAgICAgICAgICAuZXEoJ2Rpc2NvcmRfaWQnLCB0b2tlbi5kaXNjb3JkX2lkIGFzIHN0cmluZylcbiAgICAgICAgICAgIC5tYXliZVNpbmdsZSgpO1xuXG4gICAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZmV0Y2hpbmcgcHJvZmlsZSBpbiBKV1QgY2FsbGJhY2s6JywgZXJyb3IpO1xuICAgICAgICAgICAgdG9rZW4ucm9sZSA9ICdndWVzdCc7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnPT09PT09PT09PSDwn5+hIEpXVCBDQUxMQkFDSyBFTkQgPT09PT09PT09PVxcbicpO1xuICAgICAgICAgICAgcmV0dXJuIHRva2VuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmICghZGF0YSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ+KaoO+4jyBObyBwcm9maWxlIGZvdW5kIGZvciBEaXNjb3JkIElEOicsIHRva2VuLmRpc2NvcmRfaWQpO1xuICAgICAgICAgICAgdG9rZW4ucm9sZSA9ICdndWVzdCc7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnPT09PT09PT09PSDwn5+hIEpXVCBDQUxMQkFDSyBFTkQgPT09PT09PT09PVxcbicpO1xuICAgICAgICAgICAgcmV0dXJuIHRva2VuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnNvbGUubG9nKCfinIUgUHJvZmlsZSBmb3VuZDonLCBkYXRhKTtcblxuICAgICAgICAgIC8vIFN0b3JlIHRoZSBkYXRhYmFzZSBVVUlEIGluIHRva2VuIGZvciBzZXNzaW9uXG4gICAgICAgICAgdG9rZW4uc3ViID0gZGF0YS5pZDtcblxuICAgICAgICAgIGxldCByb2xlID0gKGRhdGE/LnJvbGUgYXMgUHJvZmlsZVsncm9sZSddKSA/PyAnZ3Vlc3QnO1xuXG4gICAgICAgICAgLy8gT3duZXIgYmFja2Rvb3I6IE92ZXJyaWRlIHJvbGUgaWYgRGlzY29yZCBJRCBtYXRjaGVzXG4gICAgICAgICAgaWYgKE9XTkVSX0RJU0NPUkRfSUQgJiYgZGF0YT8uZGlzY29yZF9pZCA9PT0gT1dORVJfRElTQ09SRF9JRCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ/CfkZEgT1dORVIgTUFUQ0ghIFVwZ3JhZGluZyByb2xlIHRvIG93bmVyJyk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnICAtIE9XTkVSX0RJU0NPUkRfSUQ6JywgT1dORVJfRElTQ09SRF9JRCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnICAtIFVzZXIgRGlzY29yZCBJRDonLCBkYXRhLmRpc2NvcmRfaWQpO1xuXG4gICAgICAgICAgICByb2xlID0gJ293bmVyJztcblxuICAgICAgICAgICAgLy8gUGVyc2lzdCBvd25lciByb2xlIHRvIGRhdGFiYXNlXG4gICAgICAgICAgICBjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pbiFcbiAgICAgICAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcbiAgICAgICAgICAgICAgLnVwZGF0ZSh7IHJvbGU6ICdvd25lcicgfSlcbiAgICAgICAgICAgICAgLmVxKCdkaXNjb3JkX2lkJywgdG9rZW4uZGlzY29yZF9pZCBhcyBzdHJpbmcpO1xuXG4gICAgICAgICAgICBpZiAodXBkYXRlRXJyb3IpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEZhaWxlZCB0byB1cGRhdGUgb3duZXIgcm9sZTonLCB1cGRhdGVFcnJvcik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZygn4pyFIE93bmVyIHJvbGUgdXBkYXRlZCBpbiBkYXRhYmFzZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIHRva2VuLnJvbGUgPSByb2xlO1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdGaW5hbCB0b2tlbiByb2xlOicsIHRva2VuLnJvbGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc29sZS5sb2coJz09PT09PT09PT0g8J+foSBKV1QgQ0FMTEJBQ0sgRU5EID09PT09PT09PT1cXG4nKTtcbiAgICAgICAgcmV0dXJuIHRva2VuO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEpXVCBjYWxsYmFjayBleGNlcHRpb246JywgZXJyb3IpO1xuICAgICAgICBjb25zb2xlLmxvZygnPT09PT09PT09PSDwn5+hIEpXVCBDQUxMQkFDSyBFTkQgPT09PT09PT09PVxcbicpO1xuICAgICAgICByZXR1cm4gdG9rZW47XG4gICAgICB9XG4gICAgfSxcbiAgICBhc3luYyBzZXNzaW9uKHsgc2Vzc2lvbiwgdG9rZW4gfSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKHNlc3Npb24udXNlcikge1xuICAgICAgICAgIHNlc3Npb24udXNlci5pZCA9IHRva2VuLnN1YiBhcyBzdHJpbmc7XG4gICAgICAgICAgc2Vzc2lvbi51c2VyLnJvbGUgPSAodG9rZW4ucm9sZSBhcyBQcm9maWxlWydyb2xlJ10pID8/ICdndWVzdCc7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc2Vzc2lvbjtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1Nlc3Npb24gY2FsbGJhY2sgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgICByZXR1cm4gc2Vzc2lvbjtcbiAgICAgIH1cbiAgICB9LFxuICB9LFxufTtcblxuY29uc3QgaGFuZGxlciA9IE5leHRBdXRoKGF1dGhPcHRpb25zKTtcblxuZXhwb3J0IHsgaGFuZGxlciBhcyBHRVQsIGhhbmRsZXIgYXMgUE9TVCB9O1xuIl0sIm5hbWVzIjpbIk5leHRBdXRoIiwiRGlzY29yZFByb3ZpZGVyIiwic3VwYWJhc2VBZG1pbiIsImVuc3VyZUVudiIsInZhbHVlIiwibmFtZSIsIkVycm9yIiwiRElTQ09SRF9DTElFTlRfSUQiLCJwcm9jZXNzIiwiZW52IiwiRElTQ09SRF9DTElFTlRfU0VDUkVUIiwiTkVYVEFVVEhfU0VDUkVUIiwiT1dORVJfRElTQ09SRF9JRCIsImF1dGhPcHRpb25zIiwic2VjcmV0Iiwic2Vzc2lvbiIsInN0cmF0ZWd5IiwicHJvdmlkZXJzIiwiY2xpZW50SWQiLCJjbGllbnRTZWNyZXQiLCJhdXRob3JpemF0aW9uIiwicGFyYW1zIiwic2NvcGUiLCJwYWdlcyIsInNpZ25JbiIsImVycm9yIiwiZGVidWciLCJjYWxsYmFja3MiLCJhY2NvdW50IiwicHJvZmlsZSIsInVzZXIiLCJjb25zb2xlIiwibG9nIiwiZW1haWwiLCJpZCIsInByb3ZpZGVyQWNjb3VudElkIiwidGltZW91dFByb21pc2UiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiLCJzaWduSW5Qcm9taXNlIiwiZGlzY29yZElkIiwidG9TdHJpbmciLCJhdmF0YXJVcmwiLCJpbWFnZSIsImF2YXRhciIsInVzZXJuYW1lIiwicm9sZSIsImRhdGEiLCJleGlzdGluZ1Byb2ZpbGUiLCJzZWxlY3RFcnJvciIsImZyb20iLCJzZWxlY3QiLCJlcSIsIm1heWJlU2luZ2xlIiwibWVzc2FnZSIsImNvZGUiLCJKU09OIiwic3RyaW5naWZ5IiwidXBkYXRlRGF0YSIsInVwZGF0ZUVycm9yIiwidXBkYXRlIiwiYXZhdGFyX3VybCIsIm5ld1Byb2ZpbGUiLCJkaXNjb3JkX2lkIiwic3Vic2NyaXB0aW9uX3N0YXR1cyIsImluc2VydERhdGEiLCJpbnNlcnRFcnJvciIsImluc2VydCIsImhpbnQiLCJzdGFjayIsInJhY2UiLCJqd3QiLCJ0b2tlbiIsInN1YiIsImhhbmRsZXIiLCJHRVQiLCJQT1NUIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/auth/[...nextauth]/route.ts\n");

/***/ }),

/***/ "(rsc)/./app/api/checkout/route.ts":
/*!***********************************!*\
  !*** ./app/api/checkout/route.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var next_auth_next__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next-auth/next */ \"(rsc)/./node_modules/next-auth/next/index.js\");\n/* harmony import */ var stripe__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! stripe */ \"(rsc)/./node_modules/stripe/esm/stripe.esm.node.js\");\n/* harmony import */ var _app_api_auth_nextauth_route__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/app/api/auth/[...nextauth]/route */ \"(rsc)/./app/api/auth/[...nextauth]/route.ts\");\n/* harmony import */ var _lib_supabase__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/supabase */ \"(rsc)/./lib/supabase.ts\");\n\n\n\n\n\nif (!process.env.STRIPE_SECRET_KEY) {\n    throw new Error(\"STRIPE_SECRET_KEY is not configured\");\n}\nif (!process.env.STRIPE_PRODUCT_ID) {\n    throw new Error(\"STRIPE_PRODUCT_ID is not configured\");\n}\nconst stripe = new stripe__WEBPACK_IMPORTED_MODULE_2__[\"default\"](process.env.STRIPE_SECRET_KEY, {\n    apiVersion: \"2023-10-16\"\n});\nasync function POST(req) {\n    try {\n        // Get the user session\n        const session = await (0,next_auth_next__WEBPACK_IMPORTED_MODULE_1__.getServerSession)(_app_api_auth_nextauth_route__WEBPACK_IMPORTED_MODULE_3__.authOptions);\n        if (!session?.user?.id || !session.user.email) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n        }\n        if (!_lib_supabase__WEBPACK_IMPORTED_MODULE_4__.supabaseAdmin) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Server configuration error\"\n            }, {\n                status: 500\n            });\n        }\n        // Check if user already has a Stripe customer ID\n        const { data: profile, error: profileError } = await _lib_supabase__WEBPACK_IMPORTED_MODULE_4__.supabaseAdmin.from(\"profiles\").select(\"stripe_customer_id\").eq(\"id\", session.user.id).single();\n        if (profileError && profileError.code !== \"PGRST116\") {\n            console.error(\"Error fetching profile:\", profileError);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Database error\"\n            }, {\n                status: 500\n            });\n        }\n        let customerId = profile?.stripe_customer_id ?? undefined;\n        // Create Stripe customer if one doesn't exist\n        if (!customerId) {\n            const customer = await stripe.customers.create({\n                email: session.user.email,\n                metadata: {\n                    userId: session.user.id\n                }\n            });\n            customerId = customer.id;\n            // Save the customer ID to the database\n            const { error: updateError } = await _lib_supabase__WEBPACK_IMPORTED_MODULE_4__.supabaseAdmin.from(\"profiles\").update({\n                stripe_customer_id: customerId\n            }).eq(\"id\", session.user.id);\n            if (updateError) {\n                console.error(\"Error updating profile with customer ID:\", updateError);\n            // Continue anyway, the customer is created in Stripe\n            }\n        }\n        // Get the default price for the product\n        const product = await stripe.products.retrieve(process.env.STRIPE_PRODUCT_ID);\n        if (!product.default_price) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"No default price set for this product. Please set a default price in Stripe Dashboard.\"\n            }, {\n                status: 500\n            });\n        }\n        const priceId = typeof product.default_price === \"string\" ? product.default_price : product.default_price.id;\n        // Determine the origin for redirect URLs\n        const origin = req.headers.get(\"origin\") ?? process.env.NEXT_PUBLIC_SITE_URL ?? new URL(\"/\", req.url).origin;\n        // Create Stripe checkout session\n        const checkoutSession = await stripe.checkout.sessions.create({\n            mode: \"subscription\",\n            customer: customerId,\n            payment_method_types: [\n                \"card\"\n            ],\n            line_items: [\n                {\n                    price: priceId,\n                    quantity: 1\n                }\n            ],\n            metadata: {\n                userId: session.user.id\n            },\n            success_url: `${origin}/dashboard?success=true`,\n            cancel_url: `${origin}/pricing?canceled=true`\n        });\n        if (!checkoutSession.url) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Failed to create checkout session\"\n            }, {\n                status: 500\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            url: checkoutSession.url\n        }, {\n            status: 200\n        });\n    } catch (error) {\n        console.error(\"Checkout error:\", error);\n        const message = error instanceof Error ? error.message : \"Unknown error\";\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: `Checkout failed: ${message}`\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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eW1lbnQvLi9hcHAvYXBpL2NoZWNrb3V0L3JvdXRlLnRzP2M4ZTYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IGdldFNlcnZlclNlc3Npb24gfSBmcm9tICduZXh0LWF1dGgvbmV4dCc7XG5pbXBvcnQgU3RyaXBlIGZyb20gJ3N0cmlwZSc7XG5pbXBvcnQgeyBhdXRoT3B0aW9ucyB9IGZyb20gJ0AvYXBwL2FwaS9hdXRoL1suLi5uZXh0YXV0aF0vcm91dGUnO1xuaW1wb3J0IHsgc3VwYWJhc2VBZG1pbiB9IGZyb20gJ0AvbGliL3N1cGFiYXNlJztcblxuaWYgKCFwcm9jZXNzLmVudi5TVFJJUEVfU0VDUkVUX0tFWSkge1xuICB0aHJvdyBuZXcgRXJyb3IoJ1NUUklQRV9TRUNSRVRfS0VZIGlzIG5vdCBjb25maWd1cmVkJyk7XG59XG5cbmlmICghcHJvY2Vzcy5lbnYuU1RSSVBFX1BST0RVQ1RfSUQpIHtcbiAgdGhyb3cgbmV3IEVycm9yKCdTVFJJUEVfUFJPRFVDVF9JRCBpcyBub3QgY29uZmlndXJlZCcpO1xufVxuXG5jb25zdCBzdHJpcGUgPSBuZXcgU3RyaXBlKHByb2Nlc3MuZW52LlNUUklQRV9TRUNSRVRfS0VZLCB7XG4gIGFwaVZlcnNpb246ICcyMDIzLTEwLTE2Jyxcbn0pO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXE6IE5leHRSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgLy8gR2V0IHRoZSB1c2VyIHNlc3Npb25cbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgZ2V0U2VydmVyU2Vzc2lvbihhdXRoT3B0aW9ucyk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXI/LmlkIHx8ICFzZXNzaW9uLnVzZXIuZW1haWwpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnVW5hdXRob3JpemVkJyB9LCB7IHN0YXR1czogNDAxIH0pO1xuICAgIH1cblxuICAgIGlmICghc3VwYWJhc2VBZG1pbikge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdTZXJ2ZXIgY29uZmlndXJhdGlvbiBlcnJvcicgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBpZiB1c2VyIGFscmVhZHkgaGFzIGEgU3RyaXBlIGN1c3RvbWVyIElEXG4gICAgY29uc3QgeyBkYXRhOiBwcm9maWxlLCBlcnJvcjogcHJvZmlsZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXG4gICAgICAuZnJvbSgncHJvZmlsZXMnKVxuICAgICAgLnNlbGVjdCgnc3RyaXBlX2N1c3RvbWVyX2lkJylcbiAgICAgIC5lcSgnaWQnLCBzZXNzaW9uLnVzZXIuaWQpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAocHJvZmlsZUVycm9yICYmIHByb2ZpbGVFcnJvci5jb2RlICE9PSAnUEdSU1QxMTYnKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBwcm9maWxlOicsIHByb2ZpbGVFcnJvcik7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ0RhdGFiYXNlIGVycm9yJyB9LCB7IHN0YXR1czogNTAwIH0pO1xuICAgIH1cblxuICAgIGxldCBjdXN0b21lcklkOiBzdHJpbmcgfCB1bmRlZmluZWQgPSBwcm9maWxlPy5zdHJpcGVfY3VzdG9tZXJfaWQgPz8gdW5kZWZpbmVkO1xuXG4gICAgLy8gQ3JlYXRlIFN0cmlwZSBjdXN0b21lciBpZiBvbmUgZG9lc24ndCBleGlzdFxuICAgIGlmICghY3VzdG9tZXJJZCkge1xuICAgICAgY29uc3QgY3VzdG9tZXIgPSBhd2FpdCBzdHJpcGUuY3VzdG9tZXJzLmNyZWF0ZSh7XG4gICAgICAgIGVtYWlsOiBzZXNzaW9uLnVzZXIuZW1haWwsXG4gICAgICAgIG1ldGFkYXRhOiB7IHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkIH0sXG4gICAgICB9KTtcbiAgICAgIGN1c3RvbWVySWQgPSBjdXN0b21lci5pZDtcblxuICAgICAgLy8gU2F2ZSB0aGUgY3VzdG9tZXIgSUQgdG8gdGhlIGRhdGFiYXNlXG4gICAgICBjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxuICAgICAgICAudXBkYXRlKHsgc3RyaXBlX2N1c3RvbWVyX2lkOiBjdXN0b21lcklkIH0pXG4gICAgICAgIC5lcSgnaWQnLCBzZXNzaW9uLnVzZXIuaWQpO1xuXG4gICAgICBpZiAodXBkYXRlRXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgcHJvZmlsZSB3aXRoIGN1c3RvbWVyIElEOicsIHVwZGF0ZUVycm9yKTtcbiAgICAgICAgLy8gQ29udGludWUgYW55d2F5LCB0aGUgY3VzdG9tZXIgaXMgY3JlYXRlZCBpbiBTdHJpcGVcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBHZXQgdGhlIGRlZmF1bHQgcHJpY2UgZm9yIHRoZSBwcm9kdWN0XG4gICAgY29uc3QgcHJvZHVjdCA9IGF3YWl0IHN0cmlwZS5wcm9kdWN0cy5yZXRyaWV2ZShwcm9jZXNzLmVudi5TVFJJUEVfUFJPRFVDVF9JRCEpO1xuXG4gICAgaWYgKCFwcm9kdWN0LmRlZmF1bHRfcHJpY2UpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIGVycm9yOiAnTm8gZGVmYXVsdCBwcmljZSBzZXQgZm9yIHRoaXMgcHJvZHVjdC4gUGxlYXNlIHNldCBhIGRlZmF1bHQgcHJpY2UgaW4gU3RyaXBlIERhc2hib2FyZC4nXG4gICAgICB9LCB7IHN0YXR1czogNTAwIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHByaWNlSWQgPSB0eXBlb2YgcHJvZHVjdC5kZWZhdWx0X3ByaWNlID09PSAnc3RyaW5nJ1xuICAgICAgPyBwcm9kdWN0LmRlZmF1bHRfcHJpY2VcbiAgICAgIDogcHJvZHVjdC5kZWZhdWx0X3ByaWNlLmlkO1xuXG4gICAgLy8gRGV0ZXJtaW5lIHRoZSBvcmlnaW4gZm9yIHJlZGlyZWN0IFVSTHNcbiAgICBjb25zdCBvcmlnaW4gPVxuICAgICAgcmVxLmhlYWRlcnMuZ2V0KCdvcmlnaW4nKSA/P1xuICAgICAgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU0lURV9VUkwgPz9cbiAgICAgIG5ldyBVUkwoJy8nLCByZXEudXJsKS5vcmlnaW47XG5cbiAgICAvLyBDcmVhdGUgU3RyaXBlIGNoZWNrb3V0IHNlc3Npb25cbiAgICBjb25zdCBjaGVja291dFNlc3Npb24gPSBhd2FpdCBzdHJpcGUuY2hlY2tvdXQuc2Vzc2lvbnMuY3JlYXRlKHtcbiAgICAgIG1vZGU6ICdzdWJzY3JpcHRpb24nLFxuICAgICAgY3VzdG9tZXI6IGN1c3RvbWVySWQsXG4gICAgICBwYXltZW50X21ldGhvZF90eXBlczogWydjYXJkJ10sXG4gICAgICBsaW5lX2l0ZW1zOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBwcmljZTogcHJpY2VJZCxcbiAgICAgICAgICBxdWFudGl0eTogMSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBtZXRhZGF0YTogeyB1c2VySWQ6IHNlc3Npb24udXNlci5pZCB9LFxuICAgICAgc3VjY2Vzc191cmw6IGAke29yaWdpbn0vZGFzaGJvYXJkP3N1Y2Nlc3M9dHJ1ZWAsXG4gICAgICBjYW5jZWxfdXJsOiBgJHtvcmlnaW59L3ByaWNpbmc/Y2FuY2VsZWQ9dHJ1ZWAsXG4gICAgfSk7XG5cbiAgICBpZiAoIWNoZWNrb3V0U2Vzc2lvbi51cmwpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnRmFpbGVkIHRvIGNyZWF0ZSBjaGVja291dCBzZXNzaW9uJyB9LCB7IHN0YXR1czogNTAwIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IHVybDogY2hlY2tvdXRTZXNzaW9uLnVybCB9LCB7IHN0YXR1czogMjAwIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0NoZWNrb3V0IGVycm9yOicsIGVycm9yKTtcbiAgICBjb25zdCBtZXNzYWdlID0gZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcic7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IGBDaGVja291dCBmYWlsZWQ6ICR7bWVzc2FnZX1gIH0sIHsgc3RhdHVzOiA1MDAgfSk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJnZXRTZXJ2ZXJTZXNzaW9uIiwiU3RyaXBlIiwiYXV0aE9wdGlvbnMiLCJzdXBhYmFzZUFkbWluIiwicHJvY2VzcyIsImVudiIsIlNUUklQRV9TRUNSRVRfS0VZIiwiRXJyb3IiLCJTVFJJUEVfUFJPRFVDVF9JRCIsInN0cmlwZSIsImFwaVZlcnNpb24iLCJQT1NUIiwicmVxIiwic2Vzc2lvbiIsInVzZXIiLCJpZCIsImVtYWlsIiwianNvbiIsImVycm9yIiwic3RhdHVzIiwiZGF0YSIsInByb2ZpbGUiLCJwcm9maWxlRXJyb3IiLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJzaW5nbGUiLCJjb2RlIiwiY29uc29sZSIsImN1c3RvbWVySWQiLCJzdHJpcGVfY3VzdG9tZXJfaWQiLCJ1bmRlZmluZWQiLCJjdXN0b21lciIsImN1c3RvbWVycyIsImNyZWF0ZSIsIm1ldGFkYXRhIiwidXNlcklkIiwidXBkYXRlRXJyb3IiLCJ1cGRhdGUiLCJwcm9kdWN0IiwicHJvZHVjdHMiLCJyZXRyaWV2ZSIsImRlZmF1bHRfcHJpY2UiLCJwcmljZUlkIiwib3JpZ2luIiwiaGVhZGVycyIsImdldCIsIk5FWFRfUFVCTElDX1NJVEVfVVJMIiwiVVJMIiwidXJsIiwiY2hlY2tvdXRTZXNzaW9uIiwiY2hlY2tvdXQiLCJzZXNzaW9ucyIsIm1vZGUiLCJwYXltZW50X21ldGhvZF90eXBlcyIsImxpbmVfaXRlbXMiLCJwcmljZSIsInF1YW50aXR5Iiwic3VjY2Vzc191cmwiLCJjYW5jZWxfdXJsIiwibWVzc2FnZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/checkout/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabase.ts":
/*!*************************!*\
  !*** ./lib/supabase.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createSupabaseClient: () => (/* binding */ createSupabaseClient),\n/* harmony export */   supabase: () => (/* binding */ supabase),\n/* harmony export */   supabaseAdmin: () => (/* binding */ supabaseAdmin)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n\nconst supabaseUrl = \"https://apwazitaolmlizdqtxta.supabase.co\";\nconst supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFwd2F6aXRhb2xtbGl6ZHF0eHRhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3NTU0ODcsImV4cCI6MjA3OTMzMTQ4N30.hp-3nuh-ntNq_DrXI1iRR1DVcDGdY1hg3mPDmIoBxzI\";\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\nif (!supabaseUrl || !supabaseAnonKey) {\n    throw new Error(\"Supabase environment variables are not configured.\");\n}\n// Standard client (for browser/public use)\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey);\n// Admin client (for server-side operations requiring elevated privileges)\n// This should ONLY be used in API routes and server components\nconst supabaseAdmin = supabaseServiceRoleKey ? (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseServiceRoleKey, {\n    auth: {\n        autoRefreshToken: false,\n        persistSession: false\n    }\n}) : null;\n// Legacy helper for backwards compatibility\nconst createSupabaseClient = (key)=>{\n    const accessKey = key ?? supabaseAnonKey;\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, accessKey);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3VwYWJhc2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFxRDtBQUdyRCxNQUFNQyxjQUFjQywwQ0FBb0M7QUFDeEQsTUFBTUcsa0JBQWtCSCxrTkFBeUM7QUFDakUsTUFBTUsseUJBQXlCTCxRQUFRQyxHQUFHLENBQUNLLHlCQUF5QjtBQUVwRSxJQUFJLENBQUNQLGVBQWUsQ0FBQ0ksaUJBQWlCO0lBQ3BDLE1BQU0sSUFBSUksTUFBTTtBQUNsQjtBQUVBLDJDQUEyQztBQUNwQyxNQUFNQyxXQUFXVixtRUFBWUEsQ0FBV0MsYUFBYUksaUJBQWlCO0FBRTdFLDBFQUEwRTtBQUMxRSwrREFBK0Q7QUFDeEQsTUFBTU0sZ0JBQWdCSix5QkFDekJQLG1FQUFZQSxDQUFXQyxhQUFhTSx3QkFBd0I7SUFDMURLLE1BQU07UUFDSkMsa0JBQWtCO1FBQ2xCQyxnQkFBZ0I7SUFDbEI7QUFDRixLQUNBLEtBQUs7QUFFVCw0Q0FBNEM7QUFDckMsTUFBTUMsdUJBQXVCLENBQVVDO0lBQzVDLE1BQU1DLFlBQVlELE9BQU9YO0lBQ3pCLE9BQU9MLG1FQUFZQSxDQUFJQyxhQUFhZ0I7QUFDdEMsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovL3V2cGF5bWVudC8uL2xpYi9zdXBhYmFzZS50cz9jOTlmIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcyc7XG5pbXBvcnQgdHlwZSB7IERhdGFiYXNlIH0gZnJvbSAnQC90eXBlc19kYic7XG5cbmNvbnN0IHN1cGFiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMO1xuY29uc3Qgc3VwYWJhc2VBbm9uS2V5ID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVk7XG5jb25zdCBzdXBhYmFzZVNlcnZpY2VSb2xlS2V5ID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWTtcblxuaWYgKCFzdXBhYmFzZVVybCB8fCAhc3VwYWJhc2VBbm9uS2V5KSB7XG4gIHRocm93IG5ldyBFcnJvcignU3VwYWJhc2UgZW52aXJvbm1lbnQgdmFyaWFibGVzIGFyZSBub3QgY29uZmlndXJlZC4nKTtcbn1cblxuLy8gU3RhbmRhcmQgY2xpZW50IChmb3IgYnJvd3Nlci9wdWJsaWMgdXNlKVxuZXhwb3J0IGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50PERhdGFiYXNlPihzdXBhYmFzZVVybCwgc3VwYWJhc2VBbm9uS2V5KTtcblxuLy8gQWRtaW4gY2xpZW50IChmb3Igc2VydmVyLXNpZGUgb3BlcmF0aW9ucyByZXF1aXJpbmcgZWxldmF0ZWQgcHJpdmlsZWdlcylcbi8vIFRoaXMgc2hvdWxkIE9OTFkgYmUgdXNlZCBpbiBBUEkgcm91dGVzIGFuZCBzZXJ2ZXIgY29tcG9uZW50c1xuZXhwb3J0IGNvbnN0IHN1cGFiYXNlQWRtaW4gPSBzdXBhYmFzZVNlcnZpY2VSb2xlS2V5XG4gID8gY3JlYXRlQ2xpZW50PERhdGFiYXNlPihzdXBhYmFzZVVybCwgc3VwYWJhc2VTZXJ2aWNlUm9sZUtleSwge1xuICAgICAgYXV0aDoge1xuICAgICAgICBhdXRvUmVmcmVzaFRva2VuOiBmYWxzZSxcbiAgICAgICAgcGVyc2lzdFNlc3Npb246IGZhbHNlLFxuICAgICAgfSxcbiAgICB9KVxuICA6IG51bGw7XG5cbi8vIExlZ2FjeSBoZWxwZXIgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5XG5leHBvcnQgY29uc3QgY3JlYXRlU3VwYWJhc2VDbGllbnQgPSA8VCA9IGFueT4oa2V5Pzogc3RyaW5nKSA9PiB7XG4gIGNvbnN0IGFjY2Vzc0tleSA9IGtleSA/PyBzdXBhYmFzZUFub25LZXk7XG4gIHJldHVybiBjcmVhdGVDbGllbnQ8VD4oc3VwYWJhc2VVcmwsIGFjY2Vzc0tleSk7XG59O1xuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlQW5vbktleSIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwic3VwYWJhc2VTZXJ2aWNlUm9sZUtleSIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJFcnJvciIsInN1cGFiYXNlIiwic3VwYWJhc2VBZG1pbiIsImF1dGgiLCJhdXRvUmVmcmVzaFRva2VuIiwicGVyc2lzdFNlc3Npb24iLCJjcmVhdGVTdXBhYmFzZUNsaWVudCIsImtleSIsImFjY2Vzc0tleSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabase.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/next-auth","vendor-chunks/@babel","vendor-chunks/@supabase","vendor-chunks/tslib","vendor-chunks/jose","vendor-chunks/openid-client","vendor-chunks/oauth","vendor-chunks/object-hash","vendor-chunks/preact","vendor-chunks/uuid","vendor-chunks/preact-render-to-string","vendor-chunks/cookie","vendor-chunks/oidc-token-hash","vendor-chunks/@panva","vendor-chunks/stripe","vendor-chunks/math-intrinsics","vendor-chunks/es-errors","vendor-chunks/qs","vendor-chunks/call-bind-apply-helpers","vendor-chunks/get-proto","vendor-chunks/object-inspect","vendor-chunks/has-symbols","vendor-chunks/gopd","vendor-chunks/function-bind","vendor-chunks/side-channel","vendor-chunks/side-channel-weakmap","vendor-chunks/side-channel-map","vendor-chunks/side-channel-list","vendor-chunks/hasown","vendor-chunks/get-intrinsic","vendor-chunks/es-object-atoms","vendor-chunks/es-define-property","vendor-chunks/dunder-proto","vendor-chunks/call-bound"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcheckout%2Froute&page=%2Fapi%2Fcheckout%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcheckout%2Froute.ts&appDir=C%3A%5CUsers%5Cbeatr%5CDownloads%5Cuvpayment%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cbeatr%5CDownloads%5Cuvpayment&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();